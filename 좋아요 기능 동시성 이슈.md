# <작성중...>

# 개요
```
A라는 책에 100명의 사용자들이 좋아요 버튼을 클릭하면 좋아요 소는 100개가 된다.
근데 만약 동시에 100명이 좋아요 버튼을 누른다면 좋아요 갯수는 100개가 될까? 동시성 이슈때문에 그렇지 않음.
예전에 강의에서 들었던 내용을 복기하고 해당 동시성 이슈에 대한 원인과 해결책을 정리해보려고 한다.  
```

# 원인

```
    public BookResponseDto likeBook(final Long bookId) {
        final Book findBook = bookFindQueryService.findByIdWithPessimisticLock(bookId);

        findBook.addLike();

        return BookResponseDto.of(findBook);
    }
```

```
    @Test
    public void likeConcurrencyTest() throws InterruptedException {
        int threadCount = 100;
        ExecutorService executorService = Executors.newFixedThreadPool(33);
        CountDownLatch latch = new CountDownLatch(threadCount);
        
        for (int i = 0; i < threadCount; ++i) {
            executorService.submit(() -> {
                try {
                    bookUpdateService.likeBook(1L);
                } finally {
                    latch.countDown();
                }
            });
        }
        
        latch.await();

        Book book = bookRepository.findById(1L).orElseThrow();

        Assertions.assertThat(book.getLikes()).isEqualTo(100);
    }
```
